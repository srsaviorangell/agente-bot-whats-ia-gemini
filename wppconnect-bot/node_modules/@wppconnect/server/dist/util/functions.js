"use strict";var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports, "__esModule", { value: true });exports.autoDownload = autoDownload;exports.callWebHook = callWebHook;exports.contactToArray = contactToArray;exports.createCatalogLink = createCatalogLink;exports.createFolders = createFolders;exports.getIPAddress = getIPAddress;exports.groupNameToArray = groupNameToArray;exports.groupToArray = groupToArray;exports.setMaxListners = setMaxListners;exports.startAllSessions = startAllSessions;exports.startHelper = startHelper;exports.strToBool = strToBool;exports.unlinkAsync = void 0;














var _clientS = require("@aws-sdk/client-s3");





var _axios = _interopRequireDefault(require("axios"));
var _crypto = _interopRequireDefault(require("crypto"));

var _fs = _interopRequireDefault(require("fs"));
var _mimeTypes = _interopRequireDefault(require("mime-types"));
var _os = _interopRequireDefault(require("os"));
var _path = _interopRequireDefault(require("path"));
var _util = require("util");

var _config = _interopRequireDefault(require("../config"));
var _index = require("../mapper/index");

var _bucketAlreadyExists = require("./bucketAlreadyExists"); /*
 * Copyright 2023 WPPConnect Team
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let mime, crypto; //, aws: any;
if (_config.default.webhook.uploadS3) {mime = _config.default.webhook.uploadS3 ? _mimeTypes.default : null;crypto = _config.default.webhook.uploadS3 ? _crypto.default : null;}if (_config.default?.websocket?.uploadS3) {mime = _config.default.websocket.uploadS3 ? _mimeTypes.default : null;crypto = _config.default.websocket.uploadS3 ? _crypto.default : null;}function contactToArray(number, isGroup, isNewsletter,
isLid)
{
  const localArr = [];
  if (Array.isArray(number)) {
    for (let contact of number) {
      isGroup || isNewsletter ?
      contact = contact.split('@')[0] :
      contact = contact.split('@')[0]?.replace(/[^\w ]/g, '');
      if (contact !== '')
      if (isGroup) localArr.push(`${contact}@g.us`);else
      if (isNewsletter) localArr.push(`${contact}@newsletter`);else
      if (isLid || contact.length > 14)
      localArr.push(`${contact}@lid`);else
      localArr.push(`${contact}@c.us`);
    }
  } else {
    const arrContacts = number.split(/\s*[,;]\s*/g);
    for (let contact of arrContacts) {
      isGroup || isNewsletter ?
      contact = contact.split('@')[0] :
      contact = contact.split('@')[0]?.replace(/[^\w ]/g, '');
      if (contact !== '')
      if (isGroup) localArr.push(`${contact}@g.us`);else
      if (isNewsletter) localArr.push(`${contact}@newsletter`);else
      if (isLid || contact.length > 14)
      localArr.push(`${contact}@lid`);else
      localArr.push(`${contact}@c.us`);
    }
  }

  return localArr;
}

function groupToArray(group) {
  const localArr = [];
  if (Array.isArray(group)) {
    for (let contact of group) {
      contact = contact.split('@')[0];
      if (contact !== '') localArr.push(`${contact}@g.us`);
    }
  } else {
    const arrContacts = group.split(/\s*[,;]\s*/g);
    for (let contact of arrContacts) {
      contact = contact.split('@')[0];
      if (contact !== '') localArr.push(`${contact}@g.us`);
    }
  }

  return localArr;
}

function groupNameToArray(group) {
  const localArr = [];
  if (Array.isArray(group)) {
    for (const contact of group) {
      if (contact !== '') localArr.push(`${contact}`);
    }
  } else {
    const arrContacts = group.split(/\s*[,;]\s*/g);
    for (const contact of arrContacts) {
      if (contact !== '') localArr.push(`${contact}`);
    }
  }

  return localArr;
}

async function callWebHook(
client,
req,
event,
data)
{
  const webhook =
  client?.config.webhook || req.serverOptions.webhook.url || false;
  if (webhook) {
    if (
    req.serverOptions.webhook?.ignore && (
    req.serverOptions.webhook.ignore.includes(event) ||
    req.serverOptions.webhook.ignore.includes(data?.from) ||
    req.serverOptions.webhook.ignore.includes(data?.type)))

    return;
    if (req.serverOptions.webhook.autoDownload)
    await autoDownload(client, req, data);
    try {
      const chatId =
      data.from ||
      data.chatId || (
      data.chatId ? data.chatId._serialized : null);
      data = Object.assign({ event: event, session: client.session }, data);
      if (req.serverOptions.mapper.enable)
      data = await (0, _index.convert)(req.serverOptions.mapper.prefix, data);
      _axios.default.
      post(webhook, data).
      then(() => {
        try {
          const events = ['unreadmessages', 'onmessage'];
          if (events.includes(event) && req.serverOptions.webhook.readMessage)
          client.sendSeen(chatId);
        } catch (e) {}
      }).
      catch((e) => {
        req.logger.warn('Error calling Webhook.', e);
      });
    } catch (e) {
      req.logger.error(e);
    }
  }
}

async function autoDownload(client, req, message) {
  try {
    if (message && (message['mimetype'] || message.isMedia || message.isMMS)) {
      const buffer = await client.decryptFile(message);
      if (
      req.serverOptions.webhook.uploadS3 ||
      req.serverOptions?.websocket?.uploadS3)
      {
        const hashName = crypto.randomBytes(24).toString('hex');

        if (
        !_config.default?.aws_s3?.region ||
        !_config.default?.aws_s3?.access_key_id ||
        !_config.default?.aws_s3?.secret_key)

        throw new Error('Please, configure your aws configs');
        const s3Client = new _clientS.S3Client({
          region: _config.default?.aws_s3?.region,
          endpoint: _config.default?.aws_s3?.endpoint || undefined,
          forcePathStyle: _config.default?.aws_s3?.forcePathStyle || undefined
        });
        let bucketName = _config.default?.aws_s3?.defaultBucketName ?
        _config.default?.aws_s3?.defaultBucketName :
        client.session;
        bucketName = bucketName.
        normalize('NFD').
        replace(/[\u0300-\u036f]|[— _.,?!]/g, '').
        toLowerCase();
        bucketName =
        bucketName.length < 3 ?
        bucketName +
        `${Math.floor(Math.random() * (999 - 100 + 1)) + 100}` :
        bucketName;
        const fileName = `${
        _config.default.aws_s3.defaultBucketName ? client.session + '/' : ''}${
        hashName}.${mime.extension(message.mimetype)}`;

        if (
        !_config.default.aws_s3.defaultBucketName &&
        !(await (0, _bucketAlreadyExists.bucketAlreadyExists)(bucketName)))
        {
          await s3Client.send(
            new _clientS.CreateBucketCommand({
              Bucket: bucketName,
              ObjectOwnership: 'ObjectWriter'
            })
          );
          await s3Client.send(
            new _clientS.PutPublicAccessBlockCommand({
              Bucket: bucketName,
              PublicAccessBlockConfiguration: {
                BlockPublicAcls: false,
                IgnorePublicAcls: false,
                BlockPublicPolicy: false
              }
            })
          );
        }

        await s3Client.send(
          new _clientS.PutObjectCommand({
            Bucket: bucketName,
            Key: fileName,
            Body: buffer,
            ContentType: message.mimetype,
            ACL: 'public-read'
          })
        );

        message.fileUrl = `https://${bucketName}.s3.amazonaws.com/${fileName}`;
      } else {
        message.body = await buffer.toString('base64');
      }
    }
  } catch (e) {
    req.logger.error(e);
  }
}

async function startAllSessions(config, logger) {
  try {
    await _axios.default.post(
      `${config.host}:${config.port}/api/${config.secretKey}/start-all`
    );
  } catch (e) {
    logger.error(e);
  }
}

async function startHelper(client, req) {
  if (req.serverOptions.webhook.allUnreadOnStart) await sendUnread(client, req);

  if (req.serverOptions.archive.enable) await archive(client, req);
}

async function sendUnread(client, req) {
  req.logger.info(`${client.session} : Inicio enviar mensagens não lidas`);

  try {
    const chats = await client.getAllChatsWithMessages(true);

    if (chats && chats.length > 0) {
      for (let i = 0; i < chats.length; i++)
      for (let j = 0; j < chats[i].msgs.length; j++) {
        callWebHook(client, req, 'unreadmessages', chats[i].msgs[j]);
      }
    }

    req.logger.info(`${client.session} : Fim enviar mensagens não lidas`);
  } catch (ex) {
    req.logger.error(ex);
  }
}

async function archive(client, req) {
  async function sleep(time) {
    return new Promise((resolve) => setTimeout(resolve, time * 10));
  }

  req.logger.info(`${client.session} : Inicio arquivando chats`);

  try {
    let chats = await client.getAllChats();
    if (chats && Array.isArray(chats) && chats.length > 0) {
      chats = chats.filter((c) => !c.archive);
    }
    if (chats && Array.isArray(chats) && chats.length > 0) {
      for (let i = 0; i < chats.length; i++) {
        const date = new Date(chats[i].t * 1000);

        if (DaysBetween(date) > req.serverOptions.archive.daysToArchive) {
          await client.archiveChat(
            chats[i].id.id || chats[i].id._serialized,
            true
          );
          await sleep(
            Math.floor(Math.random() * req.serverOptions.archive.waitTime + 1)
          );
        }
      }
    }
    req.logger.info(`${client.session} : Fim arquivando chats`);
  } catch (ex) {
    req.logger.error(ex);
  }
}

function DaysBetween(StartDate) {
  const endDate = new Date();
  // The number of milliseconds in all UTC days (no DST)
  const oneDay = 1000 * 60 * 60 * 24;

  // A day in UTC always lasts 24 hours (unlike in other time formats)
  const start = Date.UTC(
    endDate.getFullYear(),
    endDate.getMonth(),
    endDate.getDate()
  );
  const end = Date.UTC(
    StartDate.getFullYear(),
    StartDate.getMonth(),
    StartDate.getDate()
  );

  // so it's safe to divide by 24 hours
  return (start - end) / oneDay;
}

function createFolders() {
  const __dirname = _path.default.resolve(_path.default.dirname(''));
  const dirFiles = _path.default.resolve(__dirname, 'WhatsAppImages');
  if (!_fs.default.existsSync(dirFiles)) {
    _fs.default.mkdirSync(dirFiles);
  }

  const dirUpload = _path.default.resolve(__dirname, 'uploads');
  if (!_fs.default.existsSync(dirUpload)) {
    _fs.default.mkdirSync(dirUpload);
  }
}

function strToBool(s) {
  return /^(true|1)$/i.test(s);
}

function getIPAddress() {
  const interfaces = _os.default.networkInterfaces();
  for (const devName in interfaces) {
    const iface = interfaces[devName];
    for (let i = 0; i < iface.length; i++) {
      const alias = iface[i];
      if (
      alias.family === 'IPv4' &&
      alias.address !== '127.0.0.1' &&
      !alias.internal)

      return alias.address;
    }
  }
  return '0.0.0.0';
}

function setMaxListners(serverOptions) {
  if (serverOptions && Number.isInteger(serverOptions.maxListeners)) {
    process.setMaxListeners(serverOptions.maxListeners);
  }
}

const unlinkAsync = exports.unlinkAsync = (0, _util.promisify)(_fs.default.unlink);

function createCatalogLink(session) {
  const [wid] = session.split('@');
  return `https://wa.me/c/${wid}`;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfY2xpZW50UyIsInJlcXVpcmUiLCJfYXhpb3MiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwiX2NyeXB0byIsIl9mcyIsIl9taW1lVHlwZXMiLCJfb3MiLCJfcGF0aCIsIl91dGlsIiwiX2NvbmZpZyIsIl9pbmRleCIsIl9idWNrZXRBbHJlYWR5RXhpc3RzIiwibWltZSIsImNyeXB0byIsImNvbmZpZyIsIndlYmhvb2siLCJ1cGxvYWRTMyIsIm1pbWV0eXBlcyIsIkNyeXB0byIsIndlYnNvY2tldCIsImNvbnRhY3RUb0FycmF5IiwibnVtYmVyIiwiaXNHcm91cCIsImlzTmV3c2xldHRlciIsImlzTGlkIiwibG9jYWxBcnIiLCJBcnJheSIsImlzQXJyYXkiLCJjb250YWN0Iiwic3BsaXQiLCJyZXBsYWNlIiwicHVzaCIsImxlbmd0aCIsImFyckNvbnRhY3RzIiwiZ3JvdXBUb0FycmF5IiwiZ3JvdXAiLCJncm91cE5hbWVUb0FycmF5IiwiY2FsbFdlYkhvb2siLCJjbGllbnQiLCJyZXEiLCJldmVudCIsImRhdGEiLCJzZXJ2ZXJPcHRpb25zIiwidXJsIiwiaWdub3JlIiwiaW5jbHVkZXMiLCJmcm9tIiwidHlwZSIsImF1dG9Eb3dubG9hZCIsImNoYXRJZCIsIl9zZXJpYWxpemVkIiwiT2JqZWN0IiwiYXNzaWduIiwic2Vzc2lvbiIsIm1hcHBlciIsImVuYWJsZSIsImNvbnZlcnQiLCJwcmVmaXgiLCJhcGkiLCJwb3N0IiwidGhlbiIsImV2ZW50cyIsInJlYWRNZXNzYWdlIiwic2VuZFNlZW4iLCJlIiwiY2F0Y2giLCJsb2dnZXIiLCJ3YXJuIiwiZXJyb3IiLCJtZXNzYWdlIiwiaXNNZWRpYSIsImlzTU1TIiwiYnVmZmVyIiwiZGVjcnlwdEZpbGUiLCJoYXNoTmFtZSIsInJhbmRvbUJ5dGVzIiwidG9TdHJpbmciLCJhd3NfczMiLCJyZWdpb24iLCJhY2Nlc3Nfa2V5X2lkIiwic2VjcmV0X2tleSIsIkVycm9yIiwiczNDbGllbnQiLCJTM0NsaWVudCIsImVuZHBvaW50IiwidW5kZWZpbmVkIiwiZm9yY2VQYXRoU3R5bGUiLCJidWNrZXROYW1lIiwiZGVmYXVsdEJ1Y2tldE5hbWUiLCJub3JtYWxpemUiLCJ0b0xvd2VyQ2FzZSIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsImZpbGVOYW1lIiwiZXh0ZW5zaW9uIiwibWltZXR5cGUiLCJidWNrZXRBbHJlYWR5RXhpc3RzIiwic2VuZCIsIkNyZWF0ZUJ1Y2tldENvbW1hbmQiLCJCdWNrZXQiLCJPYmplY3RPd25lcnNoaXAiLCJQdXRQdWJsaWNBY2Nlc3NCbG9ja0NvbW1hbmQiLCJQdWJsaWNBY2Nlc3NCbG9ja0NvbmZpZ3VyYXRpb24iLCJCbG9ja1B1YmxpY0FjbHMiLCJJZ25vcmVQdWJsaWNBY2xzIiwiQmxvY2tQdWJsaWNQb2xpY3kiLCJQdXRPYmplY3RDb21tYW5kIiwiS2V5IiwiQm9keSIsIkNvbnRlbnRUeXBlIiwiQUNMIiwiZmlsZVVybCIsImJvZHkiLCJzdGFydEFsbFNlc3Npb25zIiwiaG9zdCIsInBvcnQiLCJzZWNyZXRLZXkiLCJzdGFydEhlbHBlciIsImFsbFVucmVhZE9uU3RhcnQiLCJzZW5kVW5yZWFkIiwiYXJjaGl2ZSIsImluZm8iLCJjaGF0cyIsImdldEFsbENoYXRzV2l0aE1lc3NhZ2VzIiwiaSIsImoiLCJtc2dzIiwiZXgiLCJzbGVlcCIsInRpbWUiLCJQcm9taXNlIiwicmVzb2x2ZSIsInNldFRpbWVvdXQiLCJnZXRBbGxDaGF0cyIsImZpbHRlciIsImMiLCJkYXRlIiwiRGF0ZSIsInQiLCJEYXlzQmV0d2VlbiIsImRheXNUb0FyY2hpdmUiLCJhcmNoaXZlQ2hhdCIsImlkIiwid2FpdFRpbWUiLCJTdGFydERhdGUiLCJlbmREYXRlIiwib25lRGF5Iiwic3RhcnQiLCJVVEMiLCJnZXRGdWxsWWVhciIsImdldE1vbnRoIiwiZ2V0RGF0ZSIsImVuZCIsImNyZWF0ZUZvbGRlcnMiLCJfX2Rpcm5hbWUiLCJwYXRoIiwiZGlybmFtZSIsImRpckZpbGVzIiwiZnMiLCJleGlzdHNTeW5jIiwibWtkaXJTeW5jIiwiZGlyVXBsb2FkIiwic3RyVG9Cb29sIiwicyIsInRlc3QiLCJnZXRJUEFkZHJlc3MiLCJpbnRlcmZhY2VzIiwib3MiLCJuZXR3b3JrSW50ZXJmYWNlcyIsImRldk5hbWUiLCJpZmFjZSIsImFsaWFzIiwiZmFtaWx5IiwiYWRkcmVzcyIsImludGVybmFsIiwic2V0TWF4TGlzdG5lcnMiLCJOdW1iZXIiLCJpc0ludGVnZXIiLCJtYXhMaXN0ZW5lcnMiLCJwcm9jZXNzIiwic2V0TWF4TGlzdGVuZXJzIiwidW5saW5rQXN5bmMiLCJleHBvcnRzIiwicHJvbWlzaWZ5IiwidW5saW5rIiwiY3JlYXRlQ2F0YWxvZ0xpbmsiLCJ3aWQiXSwic291cmNlcyI6WyIuLi8uLi9zcmMvdXRpbC9mdW5jdGlvbnMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIENvcHlyaWdodCAyMDIzIFdQUENvbm5lY3QgVGVhbVxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuaW1wb3J0IHtcbiAgQ3JlYXRlQnVja2V0Q29tbWFuZCxcbiAgUHV0T2JqZWN0Q29tbWFuZCxcbiAgUHV0UHVibGljQWNjZXNzQmxvY2tDb21tYW5kLFxuICBTM0NsaWVudCxcbn0gZnJvbSAnQGF3cy1zZGsvY2xpZW50LXMzJztcbmltcG9ydCBhcGkgZnJvbSAnYXhpb3MnO1xuaW1wb3J0IENyeXB0byBmcm9tICdjcnlwdG8nO1xuaW1wb3J0IHsgUmVxdWVzdCB9IGZyb20gJ2V4cHJlc3MnO1xuaW1wb3J0IGZzIGZyb20gJ2ZzJztcbmltcG9ydCBtaW1ldHlwZXMgZnJvbSAnbWltZS10eXBlcyc7XG5pbXBvcnQgb3MgZnJvbSAnb3MnO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgeyBwcm9taXNpZnkgfSBmcm9tICd1dGlsJztcblxuaW1wb3J0IGNvbmZpZyBmcm9tICcuLi9jb25maWcnO1xuaW1wb3J0IHsgY29udmVydCB9IGZyb20gJy4uL21hcHBlci9pbmRleCc7XG5pbXBvcnQgeyBTZXJ2ZXJPcHRpb25zIH0gZnJvbSAnLi4vdHlwZXMvU2VydmVyT3B0aW9ucyc7XG5pbXBvcnQgeyBidWNrZXRBbHJlYWR5RXhpc3RzIH0gZnJvbSAnLi9idWNrZXRBbHJlYWR5RXhpc3RzJztcblxubGV0IG1pbWU6IGFueSwgY3J5cHRvOiBhbnk7IC8vLCBhd3M6IGFueTtcbmlmIChjb25maWcud2ViaG9vay51cGxvYWRTMykge1xuICBtaW1lID0gY29uZmlnLndlYmhvb2sudXBsb2FkUzMgPyBtaW1ldHlwZXMgOiBudWxsO1xuICBjcnlwdG8gPSBjb25maWcud2ViaG9vay51cGxvYWRTMyA/IENyeXB0byA6IG51bGw7XG59XG5pZiAoY29uZmlnPy53ZWJzb2NrZXQ/LnVwbG9hZFMzKSB7XG4gIG1pbWUgPSBjb25maWcud2Vic29ja2V0LnVwbG9hZFMzID8gbWltZXR5cGVzIDogbnVsbDtcbiAgY3J5cHRvID0gY29uZmlnLndlYnNvY2tldC51cGxvYWRTMyA/IENyeXB0byA6IG51bGw7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjb250YWN0VG9BcnJheShcbiAgbnVtYmVyOiBhbnksXG4gIGlzR3JvdXA/OiBib29sZWFuLFxuICBpc05ld3NsZXR0ZXI/OiBib29sZWFuLFxuICBpc0xpZD86IGJvb2xlYW5cbikge1xuICBjb25zdCBsb2NhbEFycjogYW55ID0gW107XG4gIGlmIChBcnJheS5pc0FycmF5KG51bWJlcikpIHtcbiAgICBmb3IgKGxldCBjb250YWN0IG9mIG51bWJlcikge1xuICAgICAgaXNHcm91cCB8fCBpc05ld3NsZXR0ZXJcbiAgICAgICAgPyAoY29udGFjdCA9IGNvbnRhY3Quc3BsaXQoJ0AnKVswXSlcbiAgICAgICAgOiAoY29udGFjdCA9IGNvbnRhY3Quc3BsaXQoJ0AnKVswXT8ucmVwbGFjZSgvW15cXHcgXS9nLCAnJykpO1xuICAgICAgaWYgKGNvbnRhY3QgIT09ICcnKVxuICAgICAgICBpZiAoaXNHcm91cCkgKGxvY2FsQXJyIGFzIGFueSkucHVzaChgJHtjb250YWN0fUBnLnVzYCk7XG4gICAgICAgIGVsc2UgaWYgKGlzTmV3c2xldHRlcikgKGxvY2FsQXJyIGFzIGFueSkucHVzaChgJHtjb250YWN0fUBuZXdzbGV0dGVyYCk7XG4gICAgICAgIGVsc2UgaWYgKGlzTGlkIHx8IGNvbnRhY3QubGVuZ3RoID4gMTQpXG4gICAgICAgICAgKGxvY2FsQXJyIGFzIGFueSkucHVzaChgJHtjb250YWN0fUBsaWRgKTtcbiAgICAgICAgZWxzZSAobG9jYWxBcnIgYXMgYW55KS5wdXNoKGAke2NvbnRhY3R9QGMudXNgKTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgY29uc3QgYXJyQ29udGFjdHMgPSBudW1iZXIuc3BsaXQoL1xccypbLDtdXFxzKi9nKTtcbiAgICBmb3IgKGxldCBjb250YWN0IG9mIGFyckNvbnRhY3RzKSB7XG4gICAgICBpc0dyb3VwIHx8IGlzTmV3c2xldHRlclxuICAgICAgICA/IChjb250YWN0ID0gY29udGFjdC5zcGxpdCgnQCcpWzBdKVxuICAgICAgICA6IChjb250YWN0ID0gY29udGFjdC5zcGxpdCgnQCcpWzBdPy5yZXBsYWNlKC9bXlxcdyBdL2csICcnKSk7XG4gICAgICBpZiAoY29udGFjdCAhPT0gJycpXG4gICAgICAgIGlmIChpc0dyb3VwKSAobG9jYWxBcnIgYXMgYW55KS5wdXNoKGAke2NvbnRhY3R9QGcudXNgKTtcbiAgICAgICAgZWxzZSBpZiAoaXNOZXdzbGV0dGVyKSAobG9jYWxBcnIgYXMgYW55KS5wdXNoKGAke2NvbnRhY3R9QG5ld3NsZXR0ZXJgKTtcbiAgICAgICAgZWxzZSBpZiAoaXNMaWQgfHwgY29udGFjdC5sZW5ndGggPiAxNClcbiAgICAgICAgICAobG9jYWxBcnIgYXMgYW55KS5wdXNoKGAke2NvbnRhY3R9QGxpZGApO1xuICAgICAgICBlbHNlIChsb2NhbEFyciBhcyBhbnkpLnB1c2goYCR7Y29udGFjdH1AYy51c2ApO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBsb2NhbEFycjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdyb3VwVG9BcnJheShncm91cDogYW55KSB7XG4gIGNvbnN0IGxvY2FsQXJyOiBhbnkgPSBbXTtcbiAgaWYgKEFycmF5LmlzQXJyYXkoZ3JvdXApKSB7XG4gICAgZm9yIChsZXQgY29udGFjdCBvZiBncm91cCkge1xuICAgICAgY29udGFjdCA9IGNvbnRhY3Quc3BsaXQoJ0AnKVswXTtcbiAgICAgIGlmIChjb250YWN0ICE9PSAnJykgKGxvY2FsQXJyIGFzIGFueSkucHVzaChgJHtjb250YWN0fUBnLnVzYCk7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIGNvbnN0IGFyckNvbnRhY3RzID0gZ3JvdXAuc3BsaXQoL1xccypbLDtdXFxzKi9nKTtcbiAgICBmb3IgKGxldCBjb250YWN0IG9mIGFyckNvbnRhY3RzKSB7XG4gICAgICBjb250YWN0ID0gY29udGFjdC5zcGxpdCgnQCcpWzBdO1xuICAgICAgaWYgKGNvbnRhY3QgIT09ICcnKSAobG9jYWxBcnIgYXMgYW55KS5wdXNoKGAke2NvbnRhY3R9QGcudXNgKTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gbG9jYWxBcnI7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBncm91cE5hbWVUb0FycmF5KGdyb3VwOiBhbnkpIHtcbiAgY29uc3QgbG9jYWxBcnI6IGFueSA9IFtdO1xuICBpZiAoQXJyYXkuaXNBcnJheShncm91cCkpIHtcbiAgICBmb3IgKGNvbnN0IGNvbnRhY3Qgb2YgZ3JvdXApIHtcbiAgICAgIGlmIChjb250YWN0ICE9PSAnJykgKGxvY2FsQXJyIGFzIGFueSkucHVzaChgJHtjb250YWN0fWApO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBjb25zdCBhcnJDb250YWN0cyA9IGdyb3VwLnNwbGl0KC9cXHMqWyw7XVxccyovZyk7XG4gICAgZm9yIChjb25zdCBjb250YWN0IG9mIGFyckNvbnRhY3RzKSB7XG4gICAgICBpZiAoY29udGFjdCAhPT0gJycpIChsb2NhbEFyciBhcyBhbnkpLnB1c2goYCR7Y29udGFjdH1gKTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gbG9jYWxBcnI7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjYWxsV2ViSG9vayhcbiAgY2xpZW50OiBhbnksXG4gIHJlcTogUmVxdWVzdCxcbiAgZXZlbnQ6IGFueSxcbiAgZGF0YTogYW55XG4pIHtcbiAgY29uc3Qgd2ViaG9vayA9XG4gICAgY2xpZW50Py5jb25maWcud2ViaG9vayB8fCByZXEuc2VydmVyT3B0aW9ucy53ZWJob29rLnVybCB8fCBmYWxzZTtcbiAgaWYgKHdlYmhvb2spIHtcbiAgICBpZiAoXG4gICAgICByZXEuc2VydmVyT3B0aW9ucy53ZWJob29rPy5pZ25vcmUgJiZcbiAgICAgIChyZXEuc2VydmVyT3B0aW9ucy53ZWJob29rLmlnbm9yZS5pbmNsdWRlcyhldmVudCkgfHxcbiAgICAgICAgcmVxLnNlcnZlck9wdGlvbnMud2ViaG9vay5pZ25vcmUuaW5jbHVkZXMoZGF0YT8uZnJvbSkgfHxcbiAgICAgICAgcmVxLnNlcnZlck9wdGlvbnMud2ViaG9vay5pZ25vcmUuaW5jbHVkZXMoZGF0YT8udHlwZSkpXG4gICAgKVxuICAgICAgcmV0dXJuO1xuICAgIGlmIChyZXEuc2VydmVyT3B0aW9ucy53ZWJob29rLmF1dG9Eb3dubG9hZClcbiAgICAgIGF3YWl0IGF1dG9Eb3dubG9hZChjbGllbnQsIHJlcSwgZGF0YSk7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGNoYXRJZCA9XG4gICAgICAgIGRhdGEuZnJvbSB8fFxuICAgICAgICBkYXRhLmNoYXRJZCB8fFxuICAgICAgICAoZGF0YS5jaGF0SWQgPyBkYXRhLmNoYXRJZC5fc2VyaWFsaXplZCA6IG51bGwpO1xuICAgICAgZGF0YSA9IE9iamVjdC5hc3NpZ24oeyBldmVudDogZXZlbnQsIHNlc3Npb246IGNsaWVudC5zZXNzaW9uIH0sIGRhdGEpO1xuICAgICAgaWYgKHJlcS5zZXJ2ZXJPcHRpb25zLm1hcHBlci5lbmFibGUpXG4gICAgICAgIGRhdGEgPSBhd2FpdCBjb252ZXJ0KHJlcS5zZXJ2ZXJPcHRpb25zLm1hcHBlci5wcmVmaXgsIGRhdGEpO1xuICAgICAgYXBpXG4gICAgICAgIC5wb3N0KHdlYmhvb2ssIGRhdGEpXG4gICAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgZXZlbnRzID0gWyd1bnJlYWRtZXNzYWdlcycsICdvbm1lc3NhZ2UnXTtcbiAgICAgICAgICAgIGlmIChldmVudHMuaW5jbHVkZXMoZXZlbnQpICYmIHJlcS5zZXJ2ZXJPcHRpb25zLndlYmhvb2sucmVhZE1lc3NhZ2UpXG4gICAgICAgICAgICAgIGNsaWVudC5zZW5kU2VlbihjaGF0SWQpO1xuICAgICAgICAgIH0gY2F0Y2ggKGUpIHt9XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaCgoZSkgPT4ge1xuICAgICAgICAgIHJlcS5sb2dnZXIud2FybignRXJyb3IgY2FsbGluZyBXZWJob29rLicsIGUpO1xuICAgICAgICB9KTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICByZXEubG9nZ2VyLmVycm9yKGUpO1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYXV0b0Rvd25sb2FkKGNsaWVudDogYW55LCByZXE6IGFueSwgbWVzc2FnZTogYW55KSB7XG4gIHRyeSB7XG4gICAgaWYgKG1lc3NhZ2UgJiYgKG1lc3NhZ2VbJ21pbWV0eXBlJ10gfHwgbWVzc2FnZS5pc01lZGlhIHx8IG1lc3NhZ2UuaXNNTVMpKSB7XG4gICAgICBjb25zdCBidWZmZXIgPSBhd2FpdCBjbGllbnQuZGVjcnlwdEZpbGUobWVzc2FnZSk7XG4gICAgICBpZiAoXG4gICAgICAgIHJlcS5zZXJ2ZXJPcHRpb25zLndlYmhvb2sudXBsb2FkUzMgfHxcbiAgICAgICAgcmVxLnNlcnZlck9wdGlvbnM/LndlYnNvY2tldD8udXBsb2FkUzNcbiAgICAgICkge1xuICAgICAgICBjb25zdCBoYXNoTmFtZSA9IGNyeXB0by5yYW5kb21CeXRlcygyNCkudG9TdHJpbmcoJ2hleCcpO1xuXG4gICAgICAgIGlmIChcbiAgICAgICAgICAhY29uZmlnPy5hd3NfczM/LnJlZ2lvbiB8fFxuICAgICAgICAgICFjb25maWc/LmF3c19zMz8uYWNjZXNzX2tleV9pZCB8fFxuICAgICAgICAgICFjb25maWc/LmF3c19zMz8uc2VjcmV0X2tleVxuICAgICAgICApXG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdQbGVhc2UsIGNvbmZpZ3VyZSB5b3VyIGF3cyBjb25maWdzJyk7XG4gICAgICAgIGNvbnN0IHMzQ2xpZW50ID0gbmV3IFMzQ2xpZW50KHtcbiAgICAgICAgICByZWdpb246IGNvbmZpZz8uYXdzX3MzPy5yZWdpb24sXG4gICAgICAgICAgZW5kcG9pbnQ6IGNvbmZpZz8uYXdzX3MzPy5lbmRwb2ludCB8fCB1bmRlZmluZWQsXG4gICAgICAgICAgZm9yY2VQYXRoU3R5bGU6IGNvbmZpZz8uYXdzX3MzPy5mb3JjZVBhdGhTdHlsZSB8fCB1bmRlZmluZWQsXG4gICAgICAgIH0pO1xuICAgICAgICBsZXQgYnVja2V0TmFtZSA9IGNvbmZpZz8uYXdzX3MzPy5kZWZhdWx0QnVja2V0TmFtZVxuICAgICAgICAgID8gY29uZmlnPy5hd3NfczM/LmRlZmF1bHRCdWNrZXROYW1lXG4gICAgICAgICAgOiBjbGllbnQuc2Vzc2lvbjtcbiAgICAgICAgYnVja2V0TmFtZSA9IGJ1Y2tldE5hbWVcbiAgICAgICAgICAubm9ybWFsaXplKCdORkQnKVxuICAgICAgICAgIC5yZXBsYWNlKC9bXFx1MDMwMC1cXHUwMzZmXXxb4oCUIF8uLD8hXS9nLCAnJylcbiAgICAgICAgICAudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgYnVja2V0TmFtZSA9XG4gICAgICAgICAgYnVja2V0TmFtZS5sZW5ndGggPCAzXG4gICAgICAgICAgICA/IGJ1Y2tldE5hbWUgK1xuICAgICAgICAgICAgICBgJHtNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoOTk5IC0gMTAwICsgMSkpICsgMTAwfWBcbiAgICAgICAgICAgIDogYnVja2V0TmFtZTtcbiAgICAgICAgY29uc3QgZmlsZU5hbWUgPSBgJHtcbiAgICAgICAgICBjb25maWcuYXdzX3MzLmRlZmF1bHRCdWNrZXROYW1lID8gY2xpZW50LnNlc3Npb24gKyAnLycgOiAnJ1xuICAgICAgICB9JHtoYXNoTmFtZX0uJHttaW1lLmV4dGVuc2lvbihtZXNzYWdlLm1pbWV0eXBlKX1gO1xuXG4gICAgICAgIGlmIChcbiAgICAgICAgICAhY29uZmlnLmF3c19zMy5kZWZhdWx0QnVja2V0TmFtZSAmJlxuICAgICAgICAgICEoYXdhaXQgYnVja2V0QWxyZWFkeUV4aXN0cyhidWNrZXROYW1lKSlcbiAgICAgICAgKSB7XG4gICAgICAgICAgYXdhaXQgczNDbGllbnQuc2VuZChcbiAgICAgICAgICAgIG5ldyBDcmVhdGVCdWNrZXRDb21tYW5kKHtcbiAgICAgICAgICAgICAgQnVja2V0OiBidWNrZXROYW1lLFxuICAgICAgICAgICAgICBPYmplY3RPd25lcnNoaXA6ICdPYmplY3RXcml0ZXInLFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICApO1xuICAgICAgICAgIGF3YWl0IHMzQ2xpZW50LnNlbmQoXG4gICAgICAgICAgICBuZXcgUHV0UHVibGljQWNjZXNzQmxvY2tDb21tYW5kKHtcbiAgICAgICAgICAgICAgQnVja2V0OiBidWNrZXROYW1lLFxuICAgICAgICAgICAgICBQdWJsaWNBY2Nlc3NCbG9ja0NvbmZpZ3VyYXRpb246IHtcbiAgICAgICAgICAgICAgICBCbG9ja1B1YmxpY0FjbHM6IGZhbHNlLFxuICAgICAgICAgICAgICAgIElnbm9yZVB1YmxpY0FjbHM6IGZhbHNlLFxuICAgICAgICAgICAgICAgIEJsb2NrUHVibGljUG9saWN5OiBmYWxzZSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGF3YWl0IHMzQ2xpZW50LnNlbmQoXG4gICAgICAgICAgbmV3IFB1dE9iamVjdENvbW1hbmQoe1xuICAgICAgICAgICAgQnVja2V0OiBidWNrZXROYW1lLFxuICAgICAgICAgICAgS2V5OiBmaWxlTmFtZSxcbiAgICAgICAgICAgIEJvZHk6IGJ1ZmZlcixcbiAgICAgICAgICAgIENvbnRlbnRUeXBlOiBtZXNzYWdlLm1pbWV0eXBlLFxuICAgICAgICAgICAgQUNMOiAncHVibGljLXJlYWQnLFxuICAgICAgICAgIH0pXG4gICAgICAgICk7XG5cbiAgICAgICAgbWVzc2FnZS5maWxlVXJsID0gYGh0dHBzOi8vJHtidWNrZXROYW1lfS5zMy5hbWF6b25hd3MuY29tLyR7ZmlsZU5hbWV9YDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG1lc3NhZ2UuYm9keSA9IGF3YWl0IGJ1ZmZlci50b1N0cmluZygnYmFzZTY0Jyk7XG4gICAgICB9XG4gICAgfVxuICB9IGNhdGNoIChlKSB7XG4gICAgcmVxLmxvZ2dlci5lcnJvcihlKTtcbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc3RhcnRBbGxTZXNzaW9ucyhjb25maWc6IGFueSwgbG9nZ2VyOiBhbnkpIHtcbiAgdHJ5IHtcbiAgICBhd2FpdCBhcGkucG9zdChcbiAgICAgIGAke2NvbmZpZy5ob3N0fToke2NvbmZpZy5wb3J0fS9hcGkvJHtjb25maWcuc2VjcmV0S2V5fS9zdGFydC1hbGxgXG4gICAgKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGxvZ2dlci5lcnJvcihlKTtcbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc3RhcnRIZWxwZXIoY2xpZW50OiBhbnksIHJlcTogYW55KSB7XG4gIGlmIChyZXEuc2VydmVyT3B0aW9ucy53ZWJob29rLmFsbFVucmVhZE9uU3RhcnQpIGF3YWl0IHNlbmRVbnJlYWQoY2xpZW50LCByZXEpO1xuXG4gIGlmIChyZXEuc2VydmVyT3B0aW9ucy5hcmNoaXZlLmVuYWJsZSkgYXdhaXQgYXJjaGl2ZShjbGllbnQsIHJlcSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHNlbmRVbnJlYWQoY2xpZW50OiBhbnksIHJlcTogYW55KSB7XG4gIHJlcS5sb2dnZXIuaW5mbyhgJHtjbGllbnQuc2Vzc2lvbn0gOiBJbmljaW8gZW52aWFyIG1lbnNhZ2VucyBuw6NvIGxpZGFzYCk7XG5cbiAgdHJ5IHtcbiAgICBjb25zdCBjaGF0cyA9IGF3YWl0IGNsaWVudC5nZXRBbGxDaGF0c1dpdGhNZXNzYWdlcyh0cnVlKTtcblxuICAgIGlmIChjaGF0cyAmJiBjaGF0cy5sZW5ndGggPiAwKSB7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNoYXRzLmxlbmd0aDsgaSsrKVxuICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGNoYXRzW2ldLm1zZ3MubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICBjYWxsV2ViSG9vayhjbGllbnQsIHJlcSwgJ3VucmVhZG1lc3NhZ2VzJywgY2hhdHNbaV0ubXNnc1tqXSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXEubG9nZ2VyLmluZm8oYCR7Y2xpZW50LnNlc3Npb259IDogRmltIGVudmlhciBtZW5zYWdlbnMgbsOjbyBsaWRhc2ApO1xuICB9IGNhdGNoIChleCkge1xuICAgIHJlcS5sb2dnZXIuZXJyb3IoZXgpO1xuICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGFyY2hpdmUoY2xpZW50OiBhbnksIHJlcTogYW55KSB7XG4gIGFzeW5jIGZ1bmN0aW9uIHNsZWVwKHRpbWU6IG51bWJlcikge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gc2V0VGltZW91dChyZXNvbHZlLCB0aW1lICogMTApKTtcbiAgfVxuXG4gIHJlcS5sb2dnZXIuaW5mbyhgJHtjbGllbnQuc2Vzc2lvbn0gOiBJbmljaW8gYXJxdWl2YW5kbyBjaGF0c2ApO1xuXG4gIHRyeSB7XG4gICAgbGV0IGNoYXRzID0gYXdhaXQgY2xpZW50LmdldEFsbENoYXRzKCk7XG4gICAgaWYgKGNoYXRzICYmIEFycmF5LmlzQXJyYXkoY2hhdHMpICYmIGNoYXRzLmxlbmd0aCA+IDApIHtcbiAgICAgIGNoYXRzID0gY2hhdHMuZmlsdGVyKChjKSA9PiAhYy5hcmNoaXZlKTtcbiAgICB9XG4gICAgaWYgKGNoYXRzICYmIEFycmF5LmlzQXJyYXkoY2hhdHMpICYmIGNoYXRzLmxlbmd0aCA+IDApIHtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY2hhdHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKGNoYXRzW2ldLnQgKiAxMDAwKTtcblxuICAgICAgICBpZiAoRGF5c0JldHdlZW4oZGF0ZSkgPiByZXEuc2VydmVyT3B0aW9ucy5hcmNoaXZlLmRheXNUb0FyY2hpdmUpIHtcbiAgICAgICAgICBhd2FpdCBjbGllbnQuYXJjaGl2ZUNoYXQoXG4gICAgICAgICAgICBjaGF0c1tpXS5pZC5pZCB8fCBjaGF0c1tpXS5pZC5fc2VyaWFsaXplZCxcbiAgICAgICAgICAgIHRydWVcbiAgICAgICAgICApO1xuICAgICAgICAgIGF3YWl0IHNsZWVwKFxuICAgICAgICAgICAgTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogcmVxLnNlcnZlck9wdGlvbnMuYXJjaGl2ZS53YWl0VGltZSArIDEpXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXEubG9nZ2VyLmluZm8oYCR7Y2xpZW50LnNlc3Npb259IDogRmltIGFycXVpdmFuZG8gY2hhdHNgKTtcbiAgfSBjYXRjaCAoZXgpIHtcbiAgICByZXEubG9nZ2VyLmVycm9yKGV4KTtcbiAgfVxufVxuXG5mdW5jdGlvbiBEYXlzQmV0d2VlbihTdGFydERhdGU6IERhdGUpIHtcbiAgY29uc3QgZW5kRGF0ZSA9IG5ldyBEYXRlKCk7XG4gIC8vIFRoZSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIGluIGFsbCBVVEMgZGF5cyAobm8gRFNUKVxuICBjb25zdCBvbmVEYXkgPSAxMDAwICogNjAgKiA2MCAqIDI0O1xuXG4gIC8vIEEgZGF5IGluIFVUQyBhbHdheXMgbGFzdHMgMjQgaG91cnMgKHVubGlrZSBpbiBvdGhlciB0aW1lIGZvcm1hdHMpXG4gIGNvbnN0IHN0YXJ0ID0gRGF0ZS5VVEMoXG4gICAgZW5kRGF0ZS5nZXRGdWxsWWVhcigpLFxuICAgIGVuZERhdGUuZ2V0TW9udGgoKSxcbiAgICBlbmREYXRlLmdldERhdGUoKVxuICApO1xuICBjb25zdCBlbmQgPSBEYXRlLlVUQyhcbiAgICBTdGFydERhdGUuZ2V0RnVsbFllYXIoKSxcbiAgICBTdGFydERhdGUuZ2V0TW9udGgoKSxcbiAgICBTdGFydERhdGUuZ2V0RGF0ZSgpXG4gICk7XG5cbiAgLy8gc28gaXQncyBzYWZlIHRvIGRpdmlkZSBieSAyNCBob3Vyc1xuICByZXR1cm4gKHN0YXJ0IC0gZW5kKSAvIG9uZURheTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUZvbGRlcnMoKSB7XG4gIGNvbnN0IF9fZGlybmFtZSA9IHBhdGgucmVzb2x2ZShwYXRoLmRpcm5hbWUoJycpKTtcbiAgY29uc3QgZGlyRmlsZXMgPSBwYXRoLnJlc29sdmUoX19kaXJuYW1lLCAnV2hhdHNBcHBJbWFnZXMnKTtcbiAgaWYgKCFmcy5leGlzdHNTeW5jKGRpckZpbGVzKSkge1xuICAgIGZzLm1rZGlyU3luYyhkaXJGaWxlcyk7XG4gIH1cblxuICBjb25zdCBkaXJVcGxvYWQgPSBwYXRoLnJlc29sdmUoX19kaXJuYW1lLCAndXBsb2FkcycpO1xuICBpZiAoIWZzLmV4aXN0c1N5bmMoZGlyVXBsb2FkKSkge1xuICAgIGZzLm1rZGlyU3luYyhkaXJVcGxvYWQpO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzdHJUb0Jvb2woczogc3RyaW5nKSB7XG4gIHJldHVybiAvXih0cnVlfDEpJC9pLnRlc3Qocyk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRJUEFkZHJlc3MoKSB7XG4gIGNvbnN0IGludGVyZmFjZXMgPSBvcy5uZXR3b3JrSW50ZXJmYWNlcygpO1xuICBmb3IgKGNvbnN0IGRldk5hbWUgaW4gaW50ZXJmYWNlcykge1xuICAgIGNvbnN0IGlmYWNlOiBhbnkgPSBpbnRlcmZhY2VzW2Rldk5hbWVdO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaWZhY2UubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IGFsaWFzID0gaWZhY2VbaV07XG4gICAgICBpZiAoXG4gICAgICAgIGFsaWFzLmZhbWlseSA9PT0gJ0lQdjQnICYmXG4gICAgICAgIGFsaWFzLmFkZHJlc3MgIT09ICcxMjcuMC4wLjEnICYmXG4gICAgICAgICFhbGlhcy5pbnRlcm5hbFxuICAgICAgKVxuICAgICAgICByZXR1cm4gYWxpYXMuYWRkcmVzcztcbiAgICB9XG4gIH1cbiAgcmV0dXJuICcwLjAuMC4wJztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNldE1heExpc3RuZXJzKHNlcnZlck9wdGlvbnM6IFNlcnZlck9wdGlvbnMpIHtcbiAgaWYgKHNlcnZlck9wdGlvbnMgJiYgTnVtYmVyLmlzSW50ZWdlcihzZXJ2ZXJPcHRpb25zLm1heExpc3RlbmVycykpIHtcbiAgICBwcm9jZXNzLnNldE1heExpc3RlbmVycyhzZXJ2ZXJPcHRpb25zLm1heExpc3RlbmVycyk7XG4gIH1cbn1cblxuZXhwb3J0IGNvbnN0IHVubGlua0FzeW5jID0gcHJvbWlzaWZ5KGZzLnVubGluayk7XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVDYXRhbG9nTGluayhzZXNzaW9uOiBhbnkpIHtcbiAgY29uc3QgW3dpZF0gPSBzZXNzaW9uLnNwbGl0KCdAJyk7XG4gIHJldHVybiBgaHR0cHM6Ly93YS5tZS9jLyR7d2lkfWA7XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQWVBLElBQUFBLFFBQUEsR0FBQUMsT0FBQTs7Ozs7O0FBTUEsSUFBQUMsTUFBQSxHQUFBQyxzQkFBQSxDQUFBRixPQUFBO0FBQ0EsSUFBQUcsT0FBQSxHQUFBRCxzQkFBQSxDQUFBRixPQUFBOztBQUVBLElBQUFJLEdBQUEsR0FBQUYsc0JBQUEsQ0FBQUYsT0FBQTtBQUNBLElBQUFLLFVBQUEsR0FBQUgsc0JBQUEsQ0FBQUYsT0FBQTtBQUNBLElBQUFNLEdBQUEsR0FBQUosc0JBQUEsQ0FBQUYsT0FBQTtBQUNBLElBQUFPLEtBQUEsR0FBQUwsc0JBQUEsQ0FBQUYsT0FBQTtBQUNBLElBQUFRLEtBQUEsR0FBQVIsT0FBQTs7QUFFQSxJQUFBUyxPQUFBLEdBQUFQLHNCQUFBLENBQUFGLE9BQUE7QUFDQSxJQUFBVSxNQUFBLEdBQUFWLE9BQUE7O0FBRUEsSUFBQVcsb0JBQUEsR0FBQVgsT0FBQSwwQkFBNEQsQ0FqQzVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQXFCQSxJQUFJWSxJQUFTLEVBQUVDLE1BQVcsQ0FBQyxDQUFDO0FBQzVCLElBQUlDLGVBQU0sQ0FBQ0MsT0FBTyxDQUFDQyxRQUFRLEVBQUUsQ0FDM0JKLElBQUksR0FBR0UsZUFBTSxDQUFDQyxPQUFPLENB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